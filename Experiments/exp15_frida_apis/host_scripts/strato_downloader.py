import requests
from bs4 import BeautifulSoup
import re
import warnings
import wget
import wget
import ssl
ssl._create_default_https_context = ssl._create_unverified_context
warnings.filterwarnings('ignore', message='Unverified HTTPS request')

families = ["Trickbot", "Emotet", "Dridex", "Qbot", "Ursnif", "Cobalt"]

main_page = requests.get("https://www.stratosphereips.org/datasets-malware")
soup = BeautifulSoup(main_page.text, features="html.parser")

def get_zip_address(main_page_url):
    page = requests.get(main_page_url, verify=False)
    text = page.text
    file_name = re.findall(r'<a href=".*\.zip">(.*\.zip)</a>', text)[-1]
    return f"{main_page_url}{file_name}"

count = 0

for paragraph in soup.find_all('p'):
    if a := paragraph.find('a'):
        if "CTU-Malware-Capture-" in a.get_text() and any([family in paragraph.get_text() for family in families]):
            link = a.get('href')
            """url = get_zip_address(link)
            wget.download(url, "./")"""
            count += 1
print(count)
