# USED TO ANALYSE WHY FRIDA WAS GENERATING "PYTHON HAS STOPPED RESPONDING" FOR SOME API LISTS
# MY THEORY IS THAT IT CAN ONLY SUPPORT A LIMITED RATE OF REGISTERED APIS
# THIS SCRIPT PROVES THAT ALL APIS ARE CORRECTLY REGISTERED

import gzip
from io import StringIO
import pandas as pd
import numpy as np

def gzip_to_string(file_path: str) -> str:
    """
    Open a gzip file and load the content in a string
    This function exists because the gzip may not be proprerly closed.
    In this case, the end is corrupted but the rest can be read.
    Args:
        file_path (string): path of the gzip file

    Returns:
        str: content of the gzip file
    """

    gzip_file = gzip.open(file_path, "rt")
    string = ""
    while True:
        try:
            line = gzip_file.readline()
            string += line
        except EOFError:
            break
    return string

header = ["time", "api", "category"]
print(gzip_to_string(f"frida_1104.txt.gz"))
frida_str = StringIO(gzip_to_string(f"frida_3760.txt.gz"))
dataframe = pd.read_csv(frida_str, names=header)
