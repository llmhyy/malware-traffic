import sys
import socket
import time
import signal
from timeit import default_timer as timer

host = None
port = 80

#modified from https://github.com/yantisj/tcpping/blob/master/tcpping.py

def tcp_ping(host, port):
    # Default to 10000 connections max
    maxCount = 4
    count = 0

    # Pass/Fail counters
    passed = 0
    failed = 0

    # Loop while less than max count or until Ctrl-C caught
    while count < maxCount:

        # Increment Counter
        count += 1

        success = False

        # New Socket
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        # 1sec Timeout
        s.settimeout(1)

        # Start a timer
        s_start = timer()

        # Try to Connect
        try:
            s.connect((host, int(port)))
            s.shutdown(socket.SHUT_RD)
            success = True
        
        # Connection Timed Out
        except socket.timeout:
            failed += 1
        except OSError as e:
            failed += 1

        # Stop Timer
        s_stop = timer()
        s_runtime = "%.2f" % (1000 * (s_stop - s_start))

        if success:
            passed += 1

        # Sleep for 1sec
        if count < maxCount:
            time.sleep(1)

    # Output Results if maxCount reached
    lRate = 0
    if failed != 0:
        lRate = failed / (count) * 100
        lRate = "%.2f" % lRate

    return passed
if __name__ == "__main__":
    tcp_ping("91.200.101.192", "443")