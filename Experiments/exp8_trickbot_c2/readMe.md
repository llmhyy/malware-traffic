# Experiment 8

## Goals

We want to know if our trickbot samples will connect to online C2 servers. If it's not the case and these servers are offline, these samples are useless as no encrypted connection will be established.

<img src="./doc/intro.png" width="350">

This experiment focuses on trickbot. When Trickbot is launched for the first time, it saves itself and its config file inside a folder. This config file is an encrypted file containing the C2 ips the malware will try to contact and the malware configuration.

The goal here is to find, decrypt and ping the ips to determine if the malware can connect to active hosts.

## Procedure

First, we need to find the config file. Usually, it is located inside the %AppData%/Roaming, inside a fake folder which has the name of common softwares (Glary Utilities, etc). If you don't find it this way, remember it also contains the malware itself, because it has to maintain itself when the comuter is rebooted. So the other way is to run the "task scheduler" and get the entry corresponding to the malware.

Once you have located the folder, the config file is the .ini file. When you open it, it's encrypted.

Second, we need to decrypt the config file. For this, we just use the Hasherezade script (git: https://github.com/hasherezade/malware_analysis). Run it with the following command line (python 2 required):

```
python malware_analysis/trick_settings_decoder.py --file <your_config_path> --brute
```

The typical result is this output :

<img src="./doc/decode.png" width="900">


Third, we need to ping all the IPs. To be more precise, we will initiate TCP handshakes with those servers. You need to create a .xml file with the outputs of the previous step and put them in src/encrypted folder. Then, we just use the following commandline to execute our script :

```
python3 src/ping_xml.py
```

## Analysis

This is an example of output of the final step.
```
-----------------------
decrypted\save_19_02_20.xml
ONLINE  82.146.62.52:443  [4]
ONLINE  185.65.202.240:443  [4]
ONLINE  188.227.84.209:443  [4]
ONLINE  88.99.112.87:443  [4]
ONLINE  45.148.120.13:443  [4]
-----------------------
decrypted\save_1_9_20.xml
ONLINE  45.67.231.68:443  [4]
ONLINE  36.91.87.227:449  [4]
ONLINE  103.76.169.213:449  [4]
ONLINE  181.143.186.42:449  [4]
-----------------------
decrypted\save_27_1_20.xml
ONLINE  82.146.62.52:443  [4]
ONLINE  81.177.165.145:443  [4]
ONLINE  217.107.34.151:443  [4]
-----------------------
decrypted\save_30_9_20.xml
ONLINE  195.2.93.227:443  [4]
-----------------------
decrypted\save_8_9_20.xml
ONLINE  185.205.209.241:443  [4]
ONLINE  195.123.241.187:443  [3]
ONLINE  86.104.194.116:443  [4]
ONLINE  92.62.65.163:449  [4]
ONLINE  186.159.8.218:449  [4]
ONLINE  200.116.232.186:449  [4]
-----------------------
decrypted\save_9_3_20.xml
ONLINE  5.255.96.119:443  [4]
ONLINE  82.148.16.5:443  [4]
```

We can see that al these malware samples can connect with online servers, so they are usable for our experiments.

