# Experiment 1

For this first experiment, we'll use metasploit to generate a malicious executable.
We'll generate a reverse TCP shell. This one will be executed on the victim system and will connect to the server on the attacker system.

- Victim address : 10.0.2.4
- Attacker address : 10.0.2.5

## Goals :
As a first approach, we will sniff the traffic on the victim computer in order to understand how this malicious software proceeds in term of network activity.

## Procedure :
* The attacker and the victim are in a same local network. 

<img src="Setup.png" width="1000">

* On the attacker VM, we set metasploit to listen to the network as a server for the malicious executable.
* On the victim VM, we launch Wireshark to record the traffic on the corresponding interface.
* On the victim VM, we launch the malicious executable.
* On the attacker VM, the metasploit listener connects to the malicious software and gives us a reverse shell.
* With seconds between, we type and run these commands in the reverse shell :
    - ls
    - cd ../
    - ls
    - load kiwi
    - deconnection with Ctrl-D
* On the victim VM, we save the Wireshark record in a pcap file

## Analysis :
First, a overview of the capture with Wireshark confirms us that the traffic is encrypted.

<img src="encrypted_data.png" width="1000">

To see how the packets are distributed in time, I wrote a Python script and used Scapy.
I selected all relevant packets by taking all TCP packets with the attacker IP address in source or destination in the IP header. Then, I've realized an histogram of the packets, regardless of their content, of the number of packets through time.

<img src="histogram.png" width="1000">

We can see from left to right :
- The first communication with the attacker server. It seems that it loads something into the victim computer.
- Three shorts bursts which are the three commands `ls`, `cd` and `ls`.
- One big transfer which corresponds to the loading of the kiwi module.
- A last short burst which is the connection termination.

## Conclusion :
We have been able to see an example of interpretation of traffic analysis. It was simple as we controlled the attacker malware, and provided me a good starting point.