import pandas as pd
import numpy as np


def ip_from_pid(pid=5444):
    first = pd.read_csv("process_first.csv")
    post = pd.read_csv("process_post.csv")

    first.drop(first.columns[0], axis=1, inplace=True)
    post.drop(post.columns[0], axis=1, inplace=True)

    diff = first.merge(post,indicator = True, how='right').loc[lambda x : x['_merge']!='both']

    def get_pids(current_pid):
        childs = diff[diff["parent_pid"] == current_pid]
        if childs.shape[0]==0:
            return [current_pid]
        return [current_pid] + [v for index, row in childs.iterrows() for v in get_pids(row["process_id"])]

    netstat = pd.read_csv("netstat.csv")
    netstat.drop(netstat.columns[0], axis=1, inplace=True)

    fun = lambda x: x.split(":")[0]

    a = list(map(fun, np.unique(netstat[netstat["Process ID"].isin(list(set(get_pids(pid))))]["Destination"].to_numpy())))
    return a