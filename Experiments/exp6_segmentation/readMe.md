# Experiment 6

## Goals

Afer having network-recorded the first stage of a trickbot malware, I had to segment it. This segmentation shows up the following TCP blocks : handshake, upward stream, downward stream and end of connection. It also takes into account TLS/encrypted connections.

## Procedure

Just run the script :
```
python3 ./segmentation.py
```

## Analysis

The result is the following :

<img src="./doc/capture_seg.png" width="1200">

Let's try to understand this segmentation. We can split it into 2 parts.

The first one contains the 2 first socket connections. The malware tries to connect to the IP in HTTP, but is then redirected in HTTPS. After some investigations, it appears the malware was getting the IP address of the computer with the help of a benign website `myexternalip`. The aim of this behavior is understandable : the malware will transmit the IP of the computer to the C&C server.

The second part contains the other packets. These are classified as "Failed Handshake". It is because the malware is attempting to contact these IPs (probably C&C servers), but fails to do so because these are offline.

## Conclusion

Here is the UML sequence diagram of the first stage of this trickbot malware.

<img src="./doc/diag.png" width="1000">
