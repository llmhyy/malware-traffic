from scapy.all import *
from scapy.layers.inet import IP, TCP
import matplotlib.pyplot as plt
import numpy as np

def ip_from_pcap(file):
    packets = rdpcap(file)
    return ip_from_packets(packets)


def ip_from_packets(packets):
    IPs = {}
    for packet in packets:
        if IP in packet:
            ip_from_packet = [packet[IP].src, packet[IP].dst]
            for ip_address in ip_from_packet:
                if ip_address in IPs:
                    IPs[ip_address] += 1
                else:
                    IPs[ip_address] = 1
    return max(IPs, key=IPs.get)


if __name__ == "__main__":
    print(ip_from_pcap("capture.pcap"))
    print(ip_from_pcap("trickbot.pcapng"))
    print(ip_from_pcap("trickbot2.pcapng"))
