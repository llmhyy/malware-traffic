from segmentation import get_segmentation
from api_extraction import get_malware_traces, get_segmented_flow_syscalls
from clustering import cluster_segmented_flow
import matplotlib.pyplot as plt
import numpy as np


# TODO: properly handle this
MALWARE_NAME = "2020-09-30-Trickbot-EXE.exe"
PATH = "./trickbot_1/"
TIME_DELAY_ALLOWED = 0

def correlate():

    # Get the segmentation in flows
    segmentations, packet_offsets = get_segmentation(path=PATH)
    print(len(segmentations), len(segmentations[0]))
    print(cluster_segmented_flow(segmentations))
    for segmentation in segmentations:
        if (get_segmented_flow_syscalls(segmentation, path=PATH).shape)[0]:
            print(get_segmented_flow_syscalls(segmentation, path=PATH).shape)

if __name__ == "__main__":
    correlate()
