from correlation import get_malware_segmentation_cluster_sequence
import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd

plt.figure(figsize=(18, 10))
# paths = ["trickbot1_1/", "trickbot1_2/"]
paths = ["trickbot1_1/", "trickbot1_2/", "trickbot1_3/", "trickbot1_5/"]
# fig, axes = plt.subplots(len(paths), 1, figsize=(15, 10))
df = pd.DataFrame(columns=["Api", "Malware"])
for o in range(len(paths)):
	path = paths[o]
	segmentations1, cluster_indexes1, nb_class1, call_dict_1, call_dict2_1 = get_malware_segmentation_cluster_sequence(
		path, "malware.exe")
	c1 = call_dict_1[0][:, 1]
	c1 = [str.replace(a, "\n", "") for a in c1]
	df = df.append(pd.DataFrame([[api, path] for api in c1], columns=["Api", "Malware"]), ignore_index=True)
print(df.head())
plt.title("Api calls count per malware execution trace")
g = sns.countplot(x="Api", hue="Malware", data=df, order=df["Api"].value_counts().iloc[:30].index)
g.legend(loc='upper right')
plt.xticks(rotation=45, ha="right")
plt.tight_layout()
plt.show()
