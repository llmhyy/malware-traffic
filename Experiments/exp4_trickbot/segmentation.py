from scapy.all import *
import matplotlib.pyplot as plt
import numpy as np
from sklearn.cluster import KMeans
from scipy import sparse
plt.rcParams["figure.figsize"] = (15,5)

def difference(a, b):
    count = 0
    u=zip(a,b)
    for i,j in u:
        if i!=j:
            count += 1
    return count


filtered_dict = {}

packets = rdpcap('./exp4_trickbot/cap.pcapng')

for packet in packets:
    if TCP in packet and "10.0.2.6" in [packet[IP].src, packet[IP].dst]:
        ips = [packet[IP].src, packet[IP].dst]
        ips.remove("10.0.2.6")
        if ips[0] in filtered_dict:
            filtered_dict[ips[0]].append([packet.time * 1000000, str(packet)])
        else:
            filtered_dict[ips[0]] = [[packet.time * 1000000, str(packet)]]

lists = []
for k in filtered_dict.keys():
    a = np.array(filtered_dict[k])
    lists.append(a[:,0])

plt.hist(lists, bins=500, histtype='bar', stacked=True)
plt.title('Nb of received packets, grouped')

plt.show()

"""plt.hist(times, bins=100, histtype='bar', stacked=True)
plt.title('Nb of received packets, grouped')
plt.show()"""
